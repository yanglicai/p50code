使用注意：显示芯片是ST7735S 使用的是瀚彩的显示屏，京东方的显示屏，需要调节
oled_writeCmd(0x21); 设置为oled_writeCmd(0x20); 
1.图片采用565 16bit；
2.反白显示；
3.图标取模：
//阴码 列行式 逆向 十六进制;
//每行：点阵16，索引8，输出C51

--注意电路对应的LDO是3.0V；
针对图标显示偏暗的问题：将图标的线条加大，加粗后效果好转；

修改：
1.取消组合按键查看版本，恢复默认的处理；
2.将查看版本和恢复默认放入菜单中（连按3次点火键进入）
//============================================================
V1.9A
2020.03.31 
1.完善电池充电管理，避免4.08V之后频繁开关充电芯片；
2.测量阻值时，先放电20ms，然后再测量阻值；具体放电时间，可以调节，先按照20ms来处理；
3.唤醒后，对应触摸的参数初始化1次，避开关机前的干扰；
4.只有开机状态，才允许屏蔽连按5次；关机状态相应连按5次；
5.吸烟后，延时2.5秒启动测量AD;延时

//============================================================
V1.8A
2020.03.30 修改文件：sysInit.c app_task.c battery.c
1.修复休眠唤醒电量条空白，以及吸烟时，电量条波动的问题；

统一：只在初始化时读取一次电量。
平时读取电量AD：只在没有吸烟时，或者吸烟后延时1S之后来读取，确保不会有电量的波动；
计算电池电压，在充电时，和空闲时；
电池电压和电量条保持统一：电量条基于电压来计算，且只在电池电压变化超过一定范围和充电时，才允许电池条变化；

吸烟时，获取的AD均为临时取用，不去修改系统变量；这样做隔离，比较相互干扰；

在唤醒处理 Wakeup_Event中加入限制条件： if ( Sys_Param.flag.smoke_firing == 0 ) 
2.恢复默认前，logo和版本一起显示,且不再做单独延时处理；
1）休眠唤醒
2）休眠直接吸烟
3）吸烟松手


3.所有报警，恢复默认前是0.75s，恢复默认后是1.5S；(调整为1S效果是否更好）；
4.删除变量 	uint16_t  bat_vol_ad_idle; 删除变量 charge_changeFlag
5.测试放电和充电的实际温度；

//=============================================
2020.03.26 V1.70 
烧录编号46 校验和0x00412C73 参看P50 V1.70烧录配置.png

该版本存在的bug：
1.休眠，直接吸烟，电池显示为空白；（40W带0.3R）
2.吸烟过程中，电池电量波动，在吸烟时反而比空闲时多；（电量一半，40W带0.3R）
需要完善的地方：
1.恢复默认前，logo和版本一起显示，然后2秒就关屏幕，这样方便生产测试工作电流和静态功耗；
2.恢复默认前，所有警告和阻值显示，只显示750ms，这样加快生产测试速度；
3.恢复默认前，直接吸烟时，如果已经测量过阻值，就不再显示ATO RES,缩短测试时间；

//============================================================
V1.7A
2020.03.26 
1.修复充电吸烟，然后报警，之后充电不能恢复的bug；

//============================================================
V1.6A
2020.03.25 
1.完善flash的存储读取功能；
2.修改查看版本，恢复默认导致的功率值修改问题；
3.修改充电过程中放电（无ATO，有ATO导致的），松手后，不能恢复充电的bug；

存在的bug：
1.在接触ATO时，测量阻值偏大（偏早，判断不严格的问题）

//============================================================
V1.4A
2020.03.23 区别对应恢复默认和非恢复默认

//============================================================
V1.2A
2020.03.20
1.统计9组电阻测量，计算其平均偏差，获得人为补偿值处理。
（需要多个板子的对比验证处理）

//============================================================
V1.0A
2020.03.17
1.图标采用小美好效果（美图秀秀）---容易有阴影（因为黑色背景变成了灰色背景）
2020.03.18

1.调整端口，功耗降低到30uA，且没有跳动；
2.调整端口时。
//============================================================
V1.0A
2020.03.11
1.删除快充部分，完全用普通充电；
2.处理计数显示，只有8位数的显示处理；
3.保存备份；
4.休眠后，自动锁按键；（需要修改说明书）

//============================================================
V1.09
2020.03.11
1.取消循环加减的设置；
2.解决休眠时，直接吸烟，电池电压不显示的问题；
3.解决快充充电时，check pod报警的问题；


//============================================================
V1.08
2020.03.08
1.增加开机拉幕动画，关机合幕动画；gui.c
bye之后，进入充电，会闪一下；
充电速度调慢；
短路显示为0.19的bug
修正有时主界面，随机充电的bug；
放电时，电池电压显示不更新，避免跳变；

2.加入宏定义，兼容普通充电IC（引脚定义，充电控制）
#define CHARGE_IC_IS_59121 1
使能引脚： PB10 ---USB_EN Low 有效 PB11 --USB_DET 输入检测
PA11 - USB_IN 和现在一样；
对应不再使用SC8913来处理；

1）端口初始化；
2）使能控制：开启和关闭控制；
3）检测控制；充满电的判断；

3.是否加入数据保存；（用2K空间来保存数据）--参考之前的程序；
1）保存恢复初始化标志；
2）保存功率，模式标志；
3）保存测试数据？？？？

//============================================================
V1.07
2020.03.06
1.修改复位恢复为AUTO的异常；
2.修改
3.修改默认阻值为0的异常：修改为默认为9990；
4.移除电阻不弹出，但是要有提示和恢复动作；


//============================================================
V1.06
2020.03.04
1.屏蔽快充显示；gui.c display_chargeFlashTech
2.屏蔽快充功能；
3.oled不显示，在关机状态下；充电也不显示
4.修改RBA，AUTO菜单进入的处理；
5.关机再开机，锁键保持；
6.关机充电，拔出灭屏；开机充电，拔出延时5秒动作；
7.开机充电，触摸唤醒不操作，不修改功率；

//============================================================
V1.05
2020.03.03
1.屏蔽 sys_getFireContinueEn 不再用；

bug归类；
1.修改功能性bug：
1）首先是AD测量，电压，阻值精度；
2）放电输出的区分处理；
3）电池电压的波动过滤；（用万用表测量对比）
--S级别bug：
（已经修改）
编号4：无法进行上锁； 触摸灵敏度问题，安装外壳异常；
编号8：由其他模式，修改为AUTO模式后，没有再次测量电阻；
编号10：充电关机，长期停留在bye状态，已经修改；
编号11：关机充电，不显示充电图标；
编号13：在关机状态，充电界面，拔出充电线，一直显示充电界面；(ok)
编号27：功率输出错误，25W和5W输出一样大；---(ok)
---一个是因为没有对 temp_power = Sys_Param.set_power / 10.0;功率计算没有做除10的处理；
---另一个是Sys_Param.count_10ms没有做++处理，导致一直就是输出，不会关闭；
---精度偏差，功率偏低；
--阻值偏大，取消20%的处理；
---放电中，根据峰值计算均方根值，输出效果很好；余下还要做的是电阻测量的偏差处理；
0.30比较准确，0.60不够准确；

编号19. 主体复位后，没有默认是auto模式；(ok)
编号17. short报警后，显示的阻值不是0.00，而是0.30；(ok)(函数中做了限制）
编号26.按吸烟键10S，显示的是9.9秒-(ok)--是否修改吸烟时间8秒（最长）；
电池波动的处理：

需要修改：
编号12：在充电模式下，主体不关屏，一直显示充电；（这个需要确认是否需要关屏，直接采用led呼吸显示充电状态）
可以在充电1分钟无任何操作后，关闭屏幕；

编号25：主体充电界面下休眠，拔出充电线，主体无法自动检测雾化器；（采用中断来唤醒）（插入和移除都做测试）
---ato唤醒的话，直接清零对应的标志，计数，使其重新测量；
---自动测量的完善；

--A类bug：
1（谢工测试）.进入菜单状态后，长按调节按键，会出现按键不响应的问题；

编号29.快充显示满电后，拔插usb，系统会重新充电，5分钟后停止充电；
编号18. 在充电界面，快速插拔，显示有瞬间花屏；
编号20.主体休眠状态，移除雾化器，主体没有被唤醒，雾化器也没有回复9.99的状态；

编号13~15，需要后续确认后，再做处理；

2.修改逻辑类bug：
1）自动检测阻值的处理；在检测后，弹出提示，然后回复正常显示；---增加一个提示事件：显示提示和阻值；
2）充电管理：充满后，拔出的处理；

3.增加雪狼适配器的匹配功能；
1）参考215和zephyr来处理；

2020.03.02
1.实现和优化UI的显示；
2.菜单做简化处理；取消选择颜色的菜单；颜色固定为一个值；
3. BYE采用图标显示；

图片需要优化的地方：
1.BYE的字体间隙可以再调整，使其更宽松一点；可以分割开，逐个显示；
2.时间图标，不够清晰，需要加大轮廓做处理；
3.吸烟口数的图标需要更加形象化（需要苏桂开配合修改）；
//============================================================
2020.03.01 在东莞家里，用新的UI，转化导出，使用bmp格式，更清晰，旧版本也可以如此处理；
1.将smallIcon中的图片放到bmp中，合并同类项；其中gImage_AUTO和gImage_RBA没有用的到；
2.将不同的颜色合并为一个颜色来处理，这样方便和新的UI对接；用宏定义来区分新旧UI；
3.将gui.c中的宏定义放到gui.h中，这样方便共用；
4.menu.c中，菜单的限制也要用到，颜色不再选择；先不处理
5.图片逐个替换：取消图片的数据字数，由系统自动分配；

//============================================================
2020.02.29 在东莞家里，沿用之前的旧UI
flash空间当前占用：Code+RO Data+RW Data = 62568
总共空间大小 65536 余下空间 2968
Program Size: Code=29200 RO-data=33212 RW-data=156
V1.04使用的编译器是V5.25.
1.将除了readMe.txt 以及 gui相关的之外的所有文件设定为只读，避免修改引入不必要的bug;
2.修改部分函数的名字，调整函数的位置，其他不变；
3.在每个版本的说明中，加入修改时间和地址；
4.版本修改为V1.04；
5.简化数据位的计算和调用；（保留不懂，因为这个不重要，且容易修改移植）
6.调整部分函数的注释，使其和函数功能匹配；
7.在gui.c中增加DEBUG_IS_DOING宏定义，控制时间的显示，这样看起来更美观

//============================================================
--注意电路对应的LDO是3.0V；
V1.03 2020.02.28 在深圳办公室
1.版本修改为V1.03；  gui.c-----> oled_Show_Version ----> strVersion 字符串定义
2.无法上锁：验证可以上锁；---向右滑动上锁，连按3下解锁；
3.由其他模式调节为AUTO的模式，主体没有再次读取阻值输出推送阻值；
menu.c 中设置 关键函数 menu_getMode
4.电池显示未满，充电有电流，但是主体电池图标的进度条不闪动；（先确保电池显示满）
在gui.c中实现  增加刷新的长度即可；且将对应长度做宏定义，方便后期修改；
主界面：oled_showHomePageBattery     MAX_BATTERY_LEN
充电界面：oled_showChargeBattery     MAX_CHARGE_LEN
条件更严谨，只要没有充满就要闪动？ 或者用充电电流来做判断，充电电流小于100mA，就认为已经充满？

5.关机后，充电的处理；显示处理的函数task_10msHandle中，消除必须开机才能显示的限制，其他保持不变；
6.在充电时，移除雾化器，效果等同于短按按键；现在在开机状态下，才有这个功能？？？暂时不限制
如果限制加入SYSTEM_ON的判断即可；在 task_100msHandle 中的指令 if (smoke_scanRes()) sys_shiftChargeSmokeMode(); 
加入限制即可。

V1.02测试出来的bug：
1.无法上锁：验证可以上锁；---向右滑动上锁，连按3下解锁； （ok）
2.电池显示未满，充电有电流，但是主体电池图标的进度条不闪动；（ok）
3.由其他模式调节为AUTO的模式，主体没有再次读取阻值输出推送阻值；
4.充电模式下，按5下关机，主体长显示在BYE界面，没有进入充电界面；（ok）
5.关机状态下，充电，主体显示屏不显示充电模式；  （ok）
6.充电模式下，主体不关屏一直显示充电界面；（是否需要关屏幕，还是充电10分钟后，无操作关闭屏幕）或者充满以后1分钟，关闭显示；
7.在充电界面，移除雾化器，主体不返回显示主界面；（是否需要返回主界面，等同于按键按下） （ok）


//============================================================
--注意电路对应的LDO是3.0V；
V1.02 2020.01.10 在深圳办公室，根据王玺，刘彬彬的要求做对应修改；锁定按键的方式有所调整；
1.LDO电阻修改为3.0V；
2.修正长按调节太慢的bug；
3.修正关机后，接入ATO，只需要唤醒提示一下，但是不需要开机；
4.修正吸烟时，没有完全关断充电的bug；
5.修正触摸锁太灵敏的bug；
6.修正充电关闭的条件，根据电流来判断；电压大于4.2V，电流小于500mA就关闭；
7.修正测量电阻不准确的bug；
8.用SC8913 测量电池电压；
9.调整加减按键，对应修改menu的处理；
10.修改进菜单方式为 连按3下点火键
11.AUTO方式修改为23W 30W；设定上限；

//============================================================
--注意电路对应的LDO是3.3V；

V1.01 
1.修正电池图标跳动的bug；
2.加入充电电压限制4.20V；（SC8913 + 软件监控，电压 + 时间控制）
3.完善滑动锁功能；
4.完善菜单功能；
5.ATO开路，设置为9.99，吸烟最大时间设置为9.9S；
6.电池电压大于4.17V之后1分钟，显示充满；大于4.20V之后，停止充电；
7.修正没有报警MAX POWER的bug；
8.调整报警的gui的坐标；
9.修改触摸同时按下收，不能长按的处理；
10.优化充电：判断电平确定是否进入了快充，而非读取寄存器；
11.采用__TIME___来区分程序版本，避免频繁升级版本；
12.显示RBA,AUTO的区分处理；

//============================================================
--注意电路对应的LDO是3.3V；

V1.01
1.修改模式名字，Smoke_Mode修改为SYS_RUN_MODE,其他模式修改为大写；方便区分和阅读；
2.增加一个文件myTasks.c，专门处理task相关的变量和函数；
3.优化mode_management中的模式管理和事件管理方式；
4.修改检查阻值中的bug：用了整数，应该用float，这样减少数据计算的损失，降低误差；解决阻值偏小的bug；
5.将内部使用的函数，变量，加static来修饰，方便自己阅读和分类管理函数，变量；
6.修改smoke.c中函数名字，使其和文件保持一致；
7.去除没有调用的函数；
8.在恢复默认的函数增加吸烟时间，吸烟次数；
9.删除sysinit.c调用外部硬件头文件的include语句，确保这个文件可以独立出来，方便移植；
10.清屏，采用SPI连续写入，用RAM空间换取速度；类似的字体显示也要如此操作处理；
11.tab_char_ascii_index 调整-为 _;
12.修正关机不能可靠开机的bug；
13.降低功耗为22uA~30uA；特别注意充电连接对应IO的电平和配置；
14.按照规格书调整参数：
1）最大功率调整为50W；
2）息屏时间调整为30秒；
3）吸烟超时调整为10秒；
4) 对调加减两个按键；

15.RBA AUTO
16.加入自动检测ATO和ATO接入中断唤醒功能；
17.优化QC充电功能，使其更可靠；
18.在 Sys_Param.batV 和 函数中bat_getLevel 加入补偿120mv，补偿MOS管的压降；
19.加入放电，停止充电的处理--直接断开和BAT的连接；
20.临时加入电阻处理，后期处理根本原因；


后期需要处理的：
1. 分解 gImage_RBA_118_0_42_40，拆分处理，节省代码空间，方便后期增加自动测试功能；
2. 加入看门狗限制；
3. 加入按键重启功能；
4. 加入自动测试功能；
5. 功耗在谭工那里测试，仍然有200uA，自己之前测试有20uA，存在不稳定性，后期需要优化；

//============================================================
--注意电路对应的LDO是3.3V；

V1.00 -- 2020 0104
1.完成显示，吸烟，按键，休眠，关机，锁键功能；
2.完成菜单显示；
3.完成普通充电，QC充电；

没有完成的功能：
1.组合按键进入菜单，写好代码，但是并未测试；
2.滑动触摸锁键功能，没有完成；

存在的bug：
1.休眠唤醒后，显示重新初始化，应该只是唤醒显示即可；
2.界面显示的字体，颜色和设计ID，不是很和谐；
3.休眠功耗偏大，有600uA；
4.没有做接入ATO的唤醒处理；
5.没有做自动检测ATO的功能；唤醒状态，可以用扫描做；
6.公司适配器快充没有做；存在和QC的冲突，需要优化处理；
7.电阻，电池电压的测量精度不对；



